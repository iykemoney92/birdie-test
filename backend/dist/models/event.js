"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.getEventTypes = exports.findEventByRecipientIdAndDate = exports.findByRecipientIdAndDate = exports.findEventByRecipientId = exports.findByRecipientId = exports.findAll = void 0;
const db_1 = require("../db");
const findAll = (callback) => {
    const queryString = `SELECT * FROM events  ORDER BY timestamp DESC`;
    db_1.db.query(queryString, (err, result) => {
        if (err) {
            callback(err);
        }
        const rows = result;
        const events = [];
        rows.forEach((row) => {
            events.push({
                id: row.id,
                timestamp: row.timestamp,
                event_type: row.event_type,
                caregiver_id: row.caregiver_id,
                visit_id: row.visit_id,
                payload: row.payload,
                care_recipient_id: row.care_recipient,
            });
        });
        callback(null, events);
    });
};
exports.findAll = findAll;
const findByRecipientId = (recipientId, callback) => {
    const queryString = `SELECT * FROM events WHERE care_recipient_id = ? ORDER BY timestamp DESC`;
    db_1.db.query(queryString, recipientId, (err, result) => {
        if (err) {
            callback(err);
        }
        const rows = result;
        const events = [];
        rows.forEach((row) => {
            events.push({
                id: row.id,
                timestamp: row.timestamp,
                event_type: row.event_type,
                caregiver_id: row.caregiver_id,
                visit_id: row.visit_id,
                payload: row.payload,
                care_recipient_id: row.care_recipient,
            });
        });
        callback(null, events);
    });
};
exports.findByRecipientId = findByRecipientId;
const findEventByRecipientId = (recipientId, eventId, callback) => {
    const queryString = `SELECT * FROM events WHERE care_recipient_id = ? AND event_type=?  ORDER BY timestamp DESC`;
    db_1.db.query(queryString, [recipientId, eventId], (err, result) => {
        if (err) {
            callback(err);
        }
        const rows = result;
        const events = [];
        rows.forEach((row) => {
            events.push({
                id: row.id,
                timestamp: row.timestamp,
                event_type: row.event_type,
                caregiver_id: row.caregiver_id,
                visit_id: row.visit_id,
                payload: row.payload,
                care_recipient_id: row.care_recipient,
            });
        });
        callback(null, events);
    });
};
exports.findEventByRecipientId = findEventByRecipientId;
const findByRecipientIdAndDate = (recipientId, from, to, callback) => {
    const queryString = `SELECT * FROM events WHERE care_recipient_id = ?
  AND (timestamp BETWEEN ? AND ?)  ORDER BY timestamp DESC`;
    db_1.db.query(queryString, [recipientId, from, to], (err, result) => {
        if (err) {
            callback(err);
        }
        const rows = result;
        const events = [];
        rows.forEach((row) => {
            events.push({
                id: row.id,
                timestamp: row.timestamp,
                event_type: row.event_type,
                caregiver_id: row.caregiver_id,
                visit_id: row.visit_id,
                payload: row.payload,
                care_recipient_id: row.care_recipient,
            });
        });
        callback(null, events);
    });
};
exports.findByRecipientIdAndDate = findByRecipientIdAndDate;
const findEventByRecipientIdAndDate = (recipientId, eventId, from, to, callback) => {
    const queryString = `SELECT * FROM events WHERE care_recipient_id = ?
  AND event_type=?
  AND (timestamp BETWEEN ? AND ?)  ORDER BY timestamp DESC`;
    db_1.db.query(queryString, [recipientId, eventId, from, to], (err, result) => {
        if (err) {
            callback(err);
        }
        const rows = result;
        const events = [];
        rows.forEach((row) => {
            events.push({
                id: row.id,
                timestamp: row.timestamp,
                event_type: row.event_type,
                caregiver_id: row.caregiver_id,
                visit_id: row.visit_id,
                payload: row.payload,
                care_recipient_id: row.care_recipient,
            });
        });
        callback(null, events);
    });
};
exports.findEventByRecipientIdAndDate = findEventByRecipientIdAndDate;
const getEventTypes = (callback) => {
    const queryString = "SELECT DISTINCT event_type FROM events";
    db_1.db.query(queryString, (err, result) => {
        if (err) {
            callback(err);
        }
        const rows = result;
        const results = [];
        rows.forEach((row) => {
            results.push(row);
        });
        callback(null, results);
    });
};
exports.getEventTypes = getEventTypes;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZXZlbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvbW9kZWxzL2V2ZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUNBLDhCQUEyQjtBQUdwQixNQUFNLE9BQU8sR0FBRyxDQUFDLFFBQWtCLEVBQUUsRUFBRTtJQUM1QyxNQUFNLFdBQVcsR0FBRywrQ0FBK0MsQ0FBQztJQUVwRSxPQUFFLENBQUMsS0FBSyxDQUFDLFdBQVcsRUFBRSxDQUFDLEdBQUcsRUFBRSxNQUFNLEVBQUUsRUFBRTtRQUNwQyxJQUFJLEdBQUcsRUFBRTtZQUNQLFFBQVEsQ0FBQyxHQUFHLENBQUMsQ0FBQztTQUNmO1FBQ0QsTUFBTSxJQUFJLEdBQW9CLE1BQU0sQ0FBQztRQUVyQyxNQUFNLE1BQU0sR0FBaUIsRUFBRSxDQUFDO1FBRWhDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQyxHQUFHLEVBQUUsRUFBRTtZQUNuQixNQUFNLENBQUMsSUFBSSxDQUFDO2dCQUNWLEVBQUUsRUFBRSxHQUFHLENBQUMsRUFBRTtnQkFDVixTQUFTLEVBQUUsR0FBRyxDQUFDLFNBQVM7Z0JBQ3hCLFVBQVUsRUFBRSxHQUFHLENBQUMsVUFBVTtnQkFDMUIsWUFBWSxFQUFFLEdBQUcsQ0FBQyxZQUFZO2dCQUM5QixRQUFRLEVBQUUsR0FBRyxDQUFDLFFBQVE7Z0JBQ3RCLE9BQU8sRUFBRSxHQUFHLENBQUMsT0FBTztnQkFDcEIsaUJBQWlCLEVBQUUsR0FBRyxDQUFDLGNBQWM7YUFDdEMsQ0FBQyxDQUFDO1FBQ0wsQ0FBQyxDQUFDLENBQUM7UUFFSCxRQUFRLENBQUMsSUFBSSxFQUFFLE1BQU0sQ0FBQyxDQUFDO0lBQ3pCLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDO0FBekJXLFFBQUEsT0FBTyxXQXlCbEI7QUFFSyxNQUFNLGlCQUFpQixHQUFHLENBQUMsV0FBbUIsRUFBRSxRQUFrQixFQUFFLEVBQUU7SUFDM0UsTUFBTSxXQUFXLEdBQUcsMEVBQTBFLENB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O2dCQUM5QixRQUFRLEVBQUUsR0FBRyxDQUFDLFFBQVE7Z0JBQ3RCLE9BQU8sRUFBRSxHQUFHLENBQUMsT0FBTztnQkFDcEIsaUJBQWlCLEVBQUUsR0FBRyxDQUFDLGNBQWM7YUFDdEMsQ0FBQyxDQUFDO1FBQ0wsQ0FBQyxDQUFDLENBQUM7UUFFSCxRQUFRLENBQUMsSUFBSSxFQUFFLE1BQU0sQ0FBQyxDQUFDO0lBQ3pCLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDO0FBakNXLFFBQUEsNkJBQTZCLGlDQWlDeEM7QUFFSyxNQUFNLGFBQWEsR0FBRyxDQUFDLFFBQWtCLEVBQUUsRUFBRTtJQUNsRCxNQUFNLFdBQVcsR0FBRyx3Q0FBd0MsQ0FBQztJQUU3RCxPQUFFLENBQUMsS0FBSyxDQUFDLFdBQVcsRUFBRSxDQUFDLEdBQUcsRUFBRSxNQUFNLEVBQUUsRUFBRTtRQUNwQyxJQUFJLEdBQUcsRUFBRTtZQUNQLFFBQVEsQ0FBQyxHQUFHLENBQUMsQ0FBQztTQUNmO1FBQ0QsTUFBTSxJQUFJLEdBQW9CLE1BQU0sQ0FBQztRQUVyQyxNQUFNLE9BQU8sR0FBVSxFQUFFLENBQUM7UUFFMUIsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLEdBQUcsRUFBRSxFQUFFO1lBQ25CLE9BQU8sQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDcEIsQ0FBQyxDQUFDLENBQUM7UUFFSCxRQUFRLENBQUMsSUFBSSxFQUFFLE9BQU8sQ0FBQyxDQUFDO0lBQzFCLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDO0FBakJXLFFBQUEsYUFBYSxpQkFpQnhCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQmFzaWNFdmVudCB9IGZyb20gXCIuLi90eXBlcy9ldmVudFwiO1xyXG5pbXBvcnQgeyBkYiB9IGZyb20gXCIuLi9kYlwiO1xyXG5pbXBvcnQgeyBSb3dEYXRhUGFja2V0IH0gZnJvbSBcIm15c3FsMlwiO1xyXG5cclxuZXhwb3J0IGNvbnN0IGZpbmRBbGwgPSAoY2FsbGJhY2s6IEZ1bmN0aW9uKSA9PiB7XHJcbiAgY29uc3QgcXVlcnlTdHJpbmcgPSBgU0VMRUNUICogRlJPTSBldmVudHMgIE9SREVSIEJZIHRpbWVzdGFtcCBERVNDYDtcclxuXHJcbiAgZGIucXVlcnkocXVlcnlTdHJpbmcsIChlcnIsIHJlc3VsdCkgPT4ge1xyXG4gICAgaWYgKGVycikge1xyXG4gICAgICBjYWxsYmFjayhlcnIpO1xyXG4gICAgfVxyXG4gICAgY29uc3Qgcm93cyA9IDxSb3dEYXRhUGFja2V0W10+cmVzdWx0O1xyXG5cclxuICAgIGNvbnN0IGV2ZW50czogQmFzaWNFdmVudFtdID0gW107XHJcblxyXG4gICAgcm93cy5mb3JFYWNoKChyb3cpID0+IHtcclxuICAgICAgZXZlbnRzLnB1c2goe1xyXG4gICAgICAgIGlkOiByb3cuaWQsXHJcbiAgICAgICAgdGltZXN0YW1wOiByb3cudGltZXN0YW1wLFxyXG4gICAgICAgIGV2ZW50X3R5cGU6IHJvdy5ldmVudF90eXBlLFxyXG4gICAgICAgIGNhcmVnaXZlcl9pZDogcm93LmNhcmVnaXZlcl9pZCxcclxuICAgICAgICB2aXNpdF9pZDogcm93LnZpc2l0X2lkLFxyXG4gICAgICAgIHBheWxvYWQ6IHJvdy5wYXlsb2FkLFxyXG4gICAgICAgIGNhcmVfcmVjaXBpZW50X2lkOiByb3cuY2FyZV9yZWNpcGllbnQsXHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgY2FsbGJhY2sobnVsbCwgZXZlbnRzKTtcclxuICB9KTtcclxufTtcclxuXHJcbmV4cG9ydCBjb25zdCBmaW5kQnlSZWNpcGllbnRJZCA9IChyZWNpcGllbnRJZDogc3RyaW5nLCBjYWxsYmFjazogRnVuY3Rpb24pID0+IHtcclxuICBjb25zdCBxdWVyeVN0cmluZyA9IGBTRUxFQ1QgKiBGUk9NIGV2ZW50cyBXSEVSRSBjYXJlX3JlY2lwaWVudF9pZCA9ID8gT1JERVIgQlkgdGltZXN0YW1wIERFU0NgO1xyXG5cclxuICBkYi5xdWVyeShxdWVyeVN0cmluZywgcmVjaXBpZW50SWQsIChlcnIsIHJlc3VsdCkgPT4ge1xyXG4gICAgaWYgKGVycikge1xyXG4gICAgICBjYWxsYmFjayhlcnIpO1xyXG4gICAgfVxyXG4gICAgY29uc3Qgcm93cyA9IDxSb3dEYXRhUGFja2V0W10+cmVzdWx0O1xyXG5cclxuICAgIGNvbnN0IGV2ZW50czogQmFzaWNFdmVudFtdID0gW107XHJcblxyXG4gICAgcm93cy5mb3JFYWNoKChyb3cpID0+IHtcclxuICAgICAgZXZlbnRzLnB1c2goe1xyXG4gICAgICAgIGlkOiByb3cuaWQsXHJcbiAgICAgICAgdGltZXN0YW1wOiByb3cudGltZXN0YW1wLFxyXG4gICAgICAgIGV2ZW50X3R5cGU6IHJvdy5ldmVudF90eXBlLFxyXG4gICAgICAgIGNhcmVnaXZlcl9pZDogcm93LmNhcmVnaXZlcl9pZCxcclxuICAgICAgICB2aXNpdF9pZDogcm93LnZpc2l0X2lkLFxyXG4gICAgICAgIHBheWxvYWQ6IHJvdy5wYXlsb2FkLFxyXG4gICAgICAgIGNhcmVfcmVjaXBpZW50X2lkOiByb3cuY2FyZV9yZWNpcGllbnQsXHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgY2FsbGJhY2sobnVsbCwgZXZlbnRzKTtcclxuICB9KTtcclxufTtcclxuZXhwb3J0IGNvbnN0IGZpbmRFdmVudEJ5UmVjaXBpZW50SWQgPSAoXHJcbiAgcmVjaXBpZW50SWQ6IHN0cmluZyxcclxuICBldmVudElkOiBzdHJpbmcsXHJcbiAgY2FsbGJhY2s6IEZ1bmN0aW9uXHJcbikgPT4ge1xyXG4gIGNvbnN0IHF1ZXJ5U3RyaW5nID0gYFNFTEVDVCAqIEZST00gZXZlbnRzIFdIRVJFIGNhcmVfcmVjaXBpZW50X2lkID0gPyBBTkQgZXZlbnRfdHlwZT0/ICBPUkRFUiBCWSB0aW1lc3RhbXAgREVTQ2A7XHJcblxyXG4gIGRiLnF1ZXJ5KHF1ZXJ5U3RyaW5nLCBbcmVjaXBpZW50SWQsIGV2ZW50SWRdLCAoZXJyLCByZXN1bHQpID0+IHtcclxuICAgIGlmIChlcnIpIHtcclxuICAgICAgY2FsbGJhY2soZXJyKTtcclxuICAgIH1cclxuICAgIGNvbnN0IHJvd3MgPSA8Um93RGF0YVBhY2tldFtdPnJlc3VsdDtcclxuXHJcbiAgICBjb25zdCBldmVudHM6IEJhc2ljRXZlbnRbXSA9IFtdO1xyXG5cclxuICAgIHJvd3MuZm9yRWFjaCgocm93KSA9PiB7XHJcbiAgICAgIGV2ZW50cy5wdXNoKHtcclxuICAgICAgICBpZDogcm93LmlkLFxyXG4gICAgICAgIHRpbWVzdGFtcDogcm93LnRpbWVzdGFtcCxcclxuICAgICAgICBldmVudF90eXBlOiByb3cuZXZlbnRfdHlwZSxcclxuICAgICAgICBjYXJlZ2l2ZXJfaWQ6IHJvdy5jYXJlZ2l2ZXJfaWQsXHJcbiAgICAgICAgdmlzaXRfaWQ6IHJvdy52aXNpdF9pZCxcclxuICAgICAgICBwYXlsb2FkOiByb3cucGF5bG9hZCxcclxuICAgICAgICBjYXJlX3JlY2lwaWVudF9pZDogcm93LmNhcmVfcmVjaXBpZW50LFxyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGNhbGxiYWNrKG51bGwsIGV2ZW50cyk7XHJcbiAgfSk7XHJcbn07XHJcblxyXG5leHBvcnQgY29uc3QgZmluZEJ5UmVjaXBpZW50SWRBbmREYXRlID0gKFxyXG4gIHJlY2lwaWVudElkOiBzdHJpbmcsXHJcbiAgZnJvbTogc3RyaW5nLFxyXG4gIHRvOiBzdHJpbmcsXHJcbiAgY2FsbGJhY2s6IEZ1bmN0aW9uXHJcbikgPT4ge1xyXG4gIGNvbnN0IHF1ZXJ5U3RyaW5nID0gYFNFTEVDVCAqIEZST00gZXZlbnRzIFdIRVJFIGNhcmVfcmVjaXBpZW50X2lkID0gP1xyXG4gIEFORCAodGltZXN0YW1wIEJFVFdFRU4gPyBBTkQgPykgIE9SREVSIEJZIHRpbWVzdGFtcCBERVNDYDtcclxuXHJcbiAgZGIucXVlcnkocXVlcnlTdHJpbmcsIFtyZWNpcGllbnRJZCwgZnJvbSwgdG9dLCAoZXJyLCByZXN1bHQpID0+IHtcclxuICAgIGlmIChlcnIpIHtcclxuICAgICAgY2FsbGJhY2soZXJyKTtcclxuICAgIH1cclxuICAgIGNvbnN0IHJvd3MgPSA8Um93RGF0YVBhY2tldFtdPnJlc3VsdDtcclxuXHJcbiAgICBjb25zdCBldmVudHM6IEJhc2ljRXZlbnRbXSA9IFtdO1xyXG5cclxuICAgIHJvd3MuZm9yRWFjaCgocm93KSA9PiB7XHJcbiAgICAgIGV2ZW50cy5wdXNoKHtcclxuICAgICAgICBpZDogcm93LmlkLFxyXG4gICAgICAgIHRpbWVzdGFtcDogcm93LnRpbWVzdGFtcCxcclxuICAgICAgICBldmVudF90eXBlOiByb3cuZXZlbnRfdHlwZSxcclxuICAgICAgICBjYXJlZ2l2ZXJfaWQ6IHJvdy5jYXJlZ2l2ZXJfaWQsXHJcbiAgICAgICAgdmlzaXRfaWQ6IHJvdy52aXNpdF9pZCxcclxuICAgICAgICBwYXlsb2FkOiByb3cucGF5bG9hZCxcclxuICAgICAgICBjYXJlX3JlY2lwaWVudF9pZDogcm93LmNhcmVfcmVjaXBpZW50LFxyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGNhbGxiYWNrKG51bGwsIGV2ZW50cyk7XHJcbiAgfSk7XHJcbn07XHJcblxyXG5leHBvcnQgY29uc3QgZmluZEV2ZW50QnlSZWNpcGllbnRJZEFuZERhdGUgPSAoXHJcbiAgcmVjaXBpZW50SWQ6IHN0cmluZyxcclxuICBldmVudElkOiBzdHJpbmcsXHJcbiAgZnJvbTogc3RyaW5nLFxyXG4gIHRvOiBzdHJpbmcsXHJcbiAgY2FsbGJhY2s6IEZ1bmN0aW9uXHJcbikgPT4ge1xyXG4gIGNvbnN0IHF1ZXJ5U3RyaW5nID0gYFNFTEVDVCAqIEZST00gZXZlbnRzIFdIRVJFIGNhcmVfcmVjaXBpZW50X2lkID0gP1xyXG4gIEFORCBldmVudF90eXBlPT9cclxuICBBTkQgKHRpbWVzdGFtcCBCRVRXRUVOID8gQU5EID8pICBPUkRFUiBCWSB0aW1lc3RhbXAgREVTQ2A7XHJcblxyXG4gIGRiLnF1ZXJ5KHF1ZXJ5U3RyaW5nLCBbcmVjaXBpZW50SWQsIGV2ZW50SWQsIGZyb20sIHRvXSwgKGVyciwgcmVzdWx0KSA9PiB7XHJcbiAgICBpZiAoZXJyKSB7XHJcbiAgICAgIGNhbGxiYWNrKGVycik7XHJcbiAgICB9XHJcbiAgICBjb25zdCByb3dzID0gPFJvd0RhdGFQYWNrZXRbXT5yZXN1bHQ7XHJcblxyXG4gICAgY29uc3QgZXZlbnRzOiBCYXNpY0V2ZW50W10gPSBbXTtcclxuXHJcbiAgICByb3dzLmZvckVhY2goKHJvdykgPT4ge1xyXG4gICAgICBldmVudHMucHVzaCh7XHJcbiAgICAgICAgaWQ6IHJvdy5pZCxcclxuICAgICAgICB0aW1lc3RhbXA6IHJvdy50aW1lc3RhbXAsXHJcbiAgICAgICAgZXZlbnRfdHlwZTogcm93LmV2ZW50X3R5cGUsXHJcbiAgICAgICAgY2FyZWdpdmVyX2lkOiByb3cuY2FyZWdpdmVyX2lkLFxyXG4gICAgICAgIHZpc2l0X2lkOiByb3cudmlzaXRfaWQsXHJcbiAgICAgICAgcGF5bG9hZDogcm93LnBheWxvYWQsXHJcbiAgICAgICAgY2FyZV9yZWNpcGllbnRfaWQ6IHJvdy5jYXJlX3JlY2lwaWVudCxcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBjYWxsYmFjayhudWxsLCBldmVudHMpO1xyXG4gIH0pO1xyXG59O1xyXG5cclxuZXhwb3J0IGNvbnN0IGdldEV2ZW50VHlwZXMgPSAoY2FsbGJhY2s6IEZ1bmN0aW9uKSA9PiB7XHJcbiAgY29uc3QgcXVlcnlTdHJpbmcgPSBcIlNFTEVDVCBESVNUSU5DVCBldmVudF90eXBlIEZST00gZXZlbnRzXCI7XHJcblxyXG4gIGRiLnF1ZXJ5KHF1ZXJ5U3RyaW5nLCAoZXJyLCByZXN1bHQpID0+IHtcclxuICAgIGlmIChlcnIpIHtcclxuICAgICAgY2FsbGJhY2soZXJyKTtcclxuICAgIH1cclxuICAgIGNvbnN0IHJvd3MgPSA8Um93RGF0YVBhY2tldFtdPnJlc3VsdDtcclxuXHJcbiAgICBjb25zdCByZXN1bHRzOiBhbnlbXSA9IFtdO1xyXG5cclxuICAgIHJvd3MuZm9yRWFjaCgocm93KSA9PiB7XHJcbiAgICAgIHJlc3VsdHMucHVzaChyb3cpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgY2FsbGJhY2sobnVsbCwgcmVzdWx0cyk7XHJcbiAgfSk7XHJcbn07XHJcbiJdfQ==